<!DOCTYPE html>
<HTML xmlns:th="http://www.thymeleaf.org">
<HEAD>
	<TITLE> ZTREE DEMO - Simple Data</TITLE>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="stylesheet" th:href="@{|/css/demo.css|}" type="text/css">
	<link rel="stylesheet" th:href="@{|/css/zTreeStyle/zTreeStyle.css|}"  type="text/css">
	<script type="text/javascript" th:src="@{|/assets/js/jquery-1.11.3.min.js|}"></script>
	<script type="text/javascript" th:src="@{|/js/jquery.ztree.all.js|}"></script>
	<SCRIPT type="text/javascript">
		<!--
		var setting = {
			data: {
				simpleData: {
					enable: true
				}
			},
            check: {
                enable: true
            },
			async: {
                enable: true,
                url: "/initPermissionTree/"+"[[${roleId}]]",
                type: "get"
			}
		};

		/*var zNodes =[
			{ id:1, pId:0, name:"父节点1 - 展开", open:true},
			{ id:11, pId:1, name:"父节点11 - 折叠"},
			{ id:111, pId:11, name:"叶子节点111"},
			{ id:112, pId:11, name:"叶子节点112"},
			{ id:113, pId:11, name:"叶子节点113"},
			{ id:114, pId:11, name:"叶子节点114"},
			{ id:12, pId:1, name:"父节点12 - 折叠"},
			{ id:121, pId:12, name:"叶子节点121"},
			{ id:122, pId:12, name:"叶子节点122"},
			{ id:123, pId:12, name:"叶子节点123"},
			{ id:124, pId:12, name:"叶子节点124"},
			{ id:13, pId:1, name:"父节点13 - 没有子节点", isParent:true},
			{ id:2, pId:0, name:"父节点2 - 折叠"},
			{ id:21, pId:2, name:"父节点21 - 展开", open:true},
			{ id:211, pId:21, name:"叶子节点211"},
			{ id:212, pId:21, name:"叶子节点212"},
			{ id:213, pId:21, name:"叶子节点213"},
			{ id:214, pId:21, name:"叶子节点214"},
			{ id:22, pId:2, name:"父节点22 - 折叠"}
		];*/

		$(document).ready(function(){
			$.fn.zTree.init($("#treeDemo"), setting, null);

			$("#disPermissionBut").bind("click",function () {

				var treeObj = $.fn.zTree.getZTreeObj("treeDemo");
				var nodes = treeObj.getCheckedNodes(true);
				var perIds = "";
				for (var i = 0; i < nodes.length ; i++) {
					perIds += "&id=" + nodes[i].id;
				}
				perIds = perIds.substr(1, perIds.length - 1 );

				$.ajax({
					url:"/disPermission?" + perIds + "&roleId=[[${roleId}]]",
					type:"GET",
					dataType:"json",
					success:function (data) {
						if (data.errorCode != "ok"){
							alert("分配失败!");
						} else {
                            if(confirm("权限分配成功点击确定返回列表页面！")){
                                window.location.href="/admin/role";
                            }
						}
                    },
                    error:function () {
                        alert("网络异常!分配失败!");
                    }
				})
            });




		});
		//-->
	</SCRIPT>
 </HEAD>

<BODY>
	<li id="treeDemo" class="ztree"></li>

	<button type="button" id="disPermissionBut">
		权限分配
	</button>
</BODY>
</HTML>